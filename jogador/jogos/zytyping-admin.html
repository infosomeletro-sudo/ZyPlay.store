<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZyTyping Admin — Jogo de Digitação</title>
  <meta name="theme-color" content="#0b0f19" />
  <style>
    :root{
      --bg:#0b0f19;
      --panel:#10182b;
      --line:rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:#a9b7d0;
      --ok:#23d5ab;
      --bad:#ff4d6d;
      --brand:#7c5cff;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --r:18px;
      --r2:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1000px 700px at 10% 0%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(1000px 700px at 90% 10%, rgba(35,213,171,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .app{
      width:min(1100px, 100%);
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:14px;
    }
    @media (max-width: 940px){ .app{grid-template-columns:1fr} }

    .panel{
      border:1px solid var(--line);
      background: rgba(16,24,43,.45);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .head{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background: rgba(255,255,255,.03);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:1000;
      user-select:none;
    }
    .badge{
      width:36px;height:36px;border-radius:12px;
      background: linear-gradient(135deg, var(--brand), var(--ok));
      display:grid;place-items:center;
      box-shadow: 0 10px 30px rgba(124,92,255,.25);
    }
    .brand small{display:block;color:var(--muted);font-weight:650}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-weight:900;
      transition:.15s ease;
    }
    button:hover{transform:translateY(-1px); background: rgba(255,255,255,.06)}
    button.primary{
      border-color: rgba(124,92,255,.45);
      background: rgba(124,92,255,.16);
    }
    button.danger{
      border-color: rgba(255,77,109,.45);
      background: rgba(255,77,109,.12);
    }

    .stage{padding:16px; display:flex; flex-direction:column; gap:14px;}

    .stats{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
    }
    @media (max-width: 900px){ .stats{grid-template-columns: repeat(3, 1fr)} }
    @media (max-width: 520px){ .stats{grid-template-columns: repeat(2, 1fr)} }

    .stat{
      padding:12px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
    }
    .stat .k{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.4px}
    .stat .v{font-weight:1000; font-size:18px; margin-top:4px}

    .wordbox{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
      padding:16px;
    }
    .prompt{
      font-size:14px;
      color:var(--muted);
      margin-bottom:8px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    }
    .modepill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12px;
      user-select:none;
    }

    .word{
      font-size:30px;
      font-weight:1000;
      letter-spacing:.2px;
      line-height:1.15;
      word-break:break-word;
    }
    .word .typed{color: var(--ok)}
    .word .rest{color: var(--text)}
    .word .wrong{color: var(--bad); text-decoration: underline}

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
      display:flex; gap:10px; flex-wrap:wrap;
    }

    .bar{
      margin-top:10px;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, var(--ok), var(--brand));
      transition: width .2s ease;
    }

    .inputbox{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
      padding:14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    input{
      flex:1;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size:16px;
    }
    .msg{
      min-height:20px;
      color:var(--muted);
      font-size:13px;
    }
    .msg.ok{color:var(--ok)}
    .msg.bad{color:var(--bad)}

    /* Right panel */
    .side{padding:16px; display:flex; flex-direction:column; gap:12px;}
    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(255,255,255,.03);
      padding:14px;
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    textarea{
      width:100%;
      min-height:180px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      resize:vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12.5px;
      line-height:1.35;
    }
    .small{color:var(--muted); font-size:12px; line-height:1.4}
    .row{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px;
    }
    .toggle{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    .toggle input{transform:scale(1.1)}
    .kbd{
      font-size:12px;
      padding:4px 7px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color:var(--muted);
    }
  </style>
</head>
<body>

  <div class="app">
    <section class="panel">
      <div class="head">
        <div class="brand">
          <div class="badge">Z</div>
          <div>
            ZyTyping Admin
            <small>digitação + vocabulário técnico + frases</small>
          </div>
        </div>
        <div class="controls">
          <button id="btnStart" class="primary">Iniciar</button>
          <button id="btnPause">Pausar</button>
          <button id="btnReset" class="danger">Reset</button>
        </div>
      </div>

      <div class="stage">
        <div class="stats">
          <div class="stat"><div class="k">Pontuação</div><div class="v" id="score">0</div></div>
          <div class="stat"><div class="k">Acertos</div><div class="v" id="hits">0</div></div>
          <div class="stat"><div class="k">Erros</div><div class="v" id="miss">0</div></div>
          <div class="stat"><div class="k">Nível</div><div class="v" id="lvl">1</div></div>
          <div class="stat"><div class="k">WPM</div><div class="v" id="wpm">0</div></div>
          <div class="stat"><div class="k">Precisão</div><div class="v" id="acc">100%</div></div>
        </div>

        <div class="wordbox">
          <div class="prompt">
            <span>Digite exatamente abaixo e pressione <b>Enter</b>:</span>
            <span class="modepill" id="modepill">Modo: Administração</span>
          </div>

          <div class="word" id="word">Clique em Iniciar</div>

          <div class="hint">
            <span>⏱ Tempo: <b id="time">90</b>s</span>
            <span>⚡ Velocidade: <b id="speed">1.00</b>x</span>
            <span>⌨️ Atalhos: <span class="kbd">Enter</span> enviar • <span class="kbd">Esc</span> pausar</span>
          </div>

          <div class="bar" title="tempo restante"><div id="timebar"></div></div>
        </div>

        <div class="inputbox">
          <input id="input" type="text" placeholder="Digite aqui..." autocomplete="off" spellcheck="false" />
          <button id="btnSkip" title="Pular (penalidade)">Pular</button>
        </div>

        <div class="msg" id="msg"></div>
      </div>
    </section>

    <aside class="panel">
      <div class="head">
        <div style="font-weight:1000">Modo Professor</div>
        <div class="controls">
          <button id="btnApply" class="primary">Aplicar lista</button>
        </div>
      </div>

      <div class="side">
        <div class="card">
          <label for="words">Cole 1 termo ou frase por linha (ex: inventário, fluxo de caixa, pensamentos):</label>
          <textarea id="words"></textarea>

          <div class="row">
            <div class="toggle">
              <input type="checkbox" id="toggleCase" />
              <label for="toggleCase" style="margin:0">Exigir maiúsculas/minúsculas (case-sensitive)</label>
            </div>
            <div class="toggle">
              <input type="checkbox" id="togglePunct" checked />
              <label for="togglePunct" style="margin:0">Manter pontuação (vírgula, ponto etc.)</label>
            </div>
          </div>

          <div class="small" style="margin-top:10px">
            Dica pro último ano: inclua termos como <b>DRE</b>, <b>fluxo de caixa</b>, <b>inventário</b>, <b>ROI</b>,
            e frases curtas de gestão. Isso fortalece escrita e vocabulário profissional.
          </div>
        </div>

        <div class="card">
          <div class="small">
            Se quiser, eu faço uma versão “Prova” com: tempo fixo por item, ranking e relatório final (PDF/print).
          </div>
        </div>
      </div>
    </aside>
  </div>

<script>
  // ===== LISTA PADRÃO (Admin + Inventário + Fluxo de Caixa + Frases) =====
  const DEFAULT_LIST = [
    // termos técnicos
    "planejamento estratégico",
    "análise de viabilidade econômica",
    "gestão orientada por dados",
    "indicadores de desempenho (KPI)",
    "metas SMART",
    "balanced scorecard",
    "margem de contribuição",
    "ponto de equilíbrio financeiro",
    "fluxo de caixa projetado",
    "capital de giro operacional",
    "ciclo financeiro",
    "controle de inventário",
    "inventário rotativo",
    "giro de estoque",
    "curva ABC",
    "gestão de suprimentos",
    "cadeia de valor",
    "lead time logístico",
    "nível de serviço ao cliente",
    "precificação estratégica",
    "centro de custos",
    "orçamento empresarial anual",
    "demonstrativo de resultados (DRE)",
    "balanço patrimonial simplificado",
    "lucro líquido operacional",
    "rentabilidade do negócio",
    "retorno sobre investimento (ROI)",
    "payback descontado",
    "política de crédito",
    "controle de inadimplência",
    "provisão para perdas",
    "compliance corporativo",
    "governança organizacional",
    "auditoria interna preventiva",
    "mapa de riscos empresariais",
    "matriz SWOT",
    "análise PESTEL",
    "vantagem competitiva sustentável",
    "proposta de valor ao cliente",
    "segmentação de mercado",
    "posicionamento estratégico",
    "funil de vendas estruturado",
    "taxa de conversão comercial",
    "custo de aquisição de cliente (CAC)",
    "valor do tempo de vida do cliente (LTV)",
    "benchmarking competitivo",
    "cultura organizacional forte",
    "clima organizacional saudável",
    "liderança estratégica",
    "tomada de decisão baseada em dados",
    "gestão de processos (BPM)",
    "padronização de processos",
    "melhoria contínua",
    "PDCA",
    "5W2H",
    "Kaizen",
    "Lean Management",
    "Six Sigma",
    "gestão de projetos empresariais",
    "estrutura analítica do projeto (EAP)",
    "cronograma físico-financeiro",
    "controle de escopo",
    "gestão de mudanças organizacionais",
    "gestão de stakeholders",
    "matriz RACI",
    "gestão de fornecedores",
    "negociação empresarial",
    "ética profissional",
    // frases de pensamento (curtas e úteis)
    "Sem controle não existe gestão.",
    "O que não é medido não pode ser melhorado.",
    "Fluxo de caixa é o coração da empresa.",
    "Decisões devem ser baseadas em dados, não em achismos.",
    "Inventário desorganizado gera prejuízo invisível.",
    "Quem não planeja, administra crises.",
    "Processos bem definidos reduzem erros.",
    "A estratégia define o caminho; a execução define o sucesso.",
    "Resultados sustentáveis exigem disciplina e visão de longo prazo.",
    "Liderança não é autoridade; é responsabilidade."
  ];

  // ===== STATE =====
  let list = [...DEFAULT_LIST];
  let current = "";
  let running = false;
  let paused = false;

  let score = 0, hits = 0, miss = 0, level = 1;

  let totalTime = 90;
  let timeLeft = totalTime;
  let tick = null;

  // métricas de digitação
  let startTimeMs = 0;
  let charsCorrect = 0;
  let charsTyped = 0;

  // toggles
  let caseSensitive = false;
  let keepPunct = true;

  function speedForLevel(lvl){
    return Math.min(2.35, 1 + (lvl - 1) * 0.12);
  }

  // ===== DOM =====
  const $ = (id) => document.getElementById(id);
  const elWord = $("word");
  const elInput = $("input");
  const elMsg = $("msg");
  const elScore = $("score");
  const elHits = $("hits");
  const elMiss = $("miss");
  const elLvl = $("lvl");
  const elTime = $("time");
  const elSpeed = $("speed");
  const elTimebar = $("timebar");
  const elWpm = $("wpm");
  const elAcc = $("acc");

  // ===== TEXT NORMALIZATION =====
  function normalize(s){
    let out = String(s);
    if (!keepPunct){
      // remove pontuação simples (mantém letras/números/espaço)
      out = out.replace(/[.,;:!?'"“”‘’()\-–—]/g, "");
    }
    out = out.replace(/\s+/g, " ").trim();
    if (!caseSensitive) out = out.toLowerCase();
    return out;
  }

  function pickNew(){
    current = list[Math.floor(Math.random() * list.length)] || "digite";
    renderWordPreview("");
    elInput.value = "";
    elInput.focus();
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function renderWordPreview(typed){
    const target = current;
    let html = "";
    for (let i = 0; i < target.length; i++){
      const t = typed[i];
      const c = target[i];
      if (t === undefined){
        html += `<span class="rest">${escapeHtml(c)}</span>`;
      } else if (t === c){
        html += `<span class="typed">${escapeHtml(c)}</span>`;
      } else {
        html += `<span class="wrong">${escapeHtml(c)}</span>`;
      }
    }
    elWord.innerHTML = html;
  }

  function setMsg(text, type){
    elMsg.className = "msg" + (type ? " " + type : "");
    elMsg.textContent = text || "";
  }

  function updateHUD(){
    elScore.textContent = score;
    elHits.textContent = hits;
    elMiss.textContent = miss;
    elLvl.textContent = level;

    elTime.textContent = Math.max(0, Math.ceil(timeLeft));
    const sp = speedForLevel(level);
    elSpeed.textContent = sp.toFixed(2);

    const pct = Math.max(0, Math.min(100, (timeLeft / totalTime) * 100));
    elTimebar.style.width = pct + "%";

    // WPM (padrão: 5 caracteres = 1 palavra)
    const elapsedMin = startTimeMs ? ((Date.now() - startTimeMs) / 60000) : 0;
    const wpm = (elapsedMin > 0) ? Math.round((charsCorrect / 5) / elapsedMin) : 0;
    elWpm.textContent = isFinite(wpm) ? wpm : 0;

    // Precisão
    const acc = (charsTyped > 0) ? Math.round((charsCorrect / charsTyped) * 100) : 100;
    elAcc.textContent = acc + "%";
  }

  function levelUpIfNeeded(){
    // sobe nível a cada 6 acertos
    level = 1 + Math.floor(hits / 6);
  }

  // ===== GAME LOOP =====
  function start(){
    if (running) return;
    running = true;
    paused = false;

    if (!startTimeMs) startTimeMs = Date.now();

    setMsg("Valendo! Digite e pressione Enter.", "");
    pickNew();

    if (tick) clearInterval(tick);
    tick = setInterval(() => {
      if (!running || paused) return;
      const sp = speedForLevel(level);
      timeLeft -= 0.25 * sp;
      if (timeLeft <= 0){
        timeLeft = 0;
        gameOver();
      }
      updateHUD();
    }, 250);

    updateHUD();
  }

  function pause(){
    if (!running) return;
    paused = !paused;
    setMsg(paused ? "Pausado." : "Continuando...", "");
    if (!paused) elInput.focus();
  }

  function reset(){
    running = false; paused = false;

    score = 0; hits = 0; miss = 0; level = 1;
    timeLeft = totalTime;
    current = "";

    startTimeMs = 0;
    charsCorrect = 0;
    charsTyped = 0;

    if (tick) clearInterval(tick);
    tick = null;

    elWord.textContent = "Clique em Iniciar";
    elInput.value = "";
    setMsg("Pronto. Clique em Iniciar.", "");
    updateHUD();
  }

  function gameOver(){
    running = false;
    paused = false;
    if (tick) clearInterval(tick);
    tick = null;

    updateHUD();
    setMsg(`Fim de jogo! Pontos: ${score} | WPM: ${$("wpm").textContent} | Precisão: ${$("acc").textContent}`, "bad");
    elInput.blur();
  }

  function submit(){
    if (!running || paused) return;

    const typedRaw = elInput.value;
    const targetRaw = current;

    // métricas (conta tudo que o aluno digitou)
    charsTyped += typedRaw.length;

    const typed = normalize(typedRaw);
    const target = normalize(targetRaw);

    if (typed === target){
      hits++;

      // conta como correto o tamanho do alvo "normalizado" (para WPM mais justo)
      charsCorrect += target.length;

      score += Math.round(10 * speedForLevel(level));
      timeLeft = Math.min(totalTime, timeLeft + 2.5);
      setMsg("✅ Certo!", "ok");

      levelUpIfNeeded();
      pickNew();
    } else {
      miss++;

      // conta acertos parciais (para precisão)
      const minLen = Math.min(typed.length, target.length);
      let partialCorrect = 0;
      for (let i = 0; i < minLen; i++){
        if (typed[i] === target[i]) partialCorrect++;
      }
      charsCorrect += partialCorrect;

      score = Math.max(0, score - 5);
      timeLeft = Math.max(0, timeLeft - 3.5);
      setMsg("❌ Errado. Corrija e tente novamente (ou pule).", "bad");

      renderWordPreview(typedRaw);

      if (timeLeft <= 0) gameOver();
    }

    updateHUD();
  }

  function skip(){
    if (!running || paused) return;
    miss++;
    score = Math.max(0, score - 3);
    timeLeft = Math.max(0, timeLeft - 2.5);
    setMsg("⏭ Pulou (com penalidade).", "");
    pickNew();
    if (timeLeft <= 0) gameOver();
    updateHUD();
  }

  // ===== EVENTS =====
  $("btnStart").addEventListener("click", start);
  $("btnPause").addEventListener("click", pause);
  $("btnReset").addEventListener("click", reset);
  $("btnSkip").addEventListener("click", skip);

  elInput.addEventListener("input", () => {
    if (!running) return;
    renderWordPreview(elInput.value);
  });

  elInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") submit();
    if (e.key === "Escape") pause();
  });

  $("btnApply").addEventListener("click", () => {
    const raw = $("words").value || "";
    const lines = raw
      .split(/\r?\n/)
      .map(s => s.trim())
      .filter(Boolean);

    if (lines.length >= 5){
      list = lines;
      $("modepill").textContent = "Modo: Lista do Professor";
      setMsg(`Lista aplicada! (${list.length} itens)`, "ok");
      if (running && !paused) pickNew();
    } else {
      setMsg("Cole pelo menos 5 linhas (1 termo/frase por linha).", "bad");
    }
  });

  $("toggleCase").addEventListener("change", (e) => {
    caseSensitive = !!e.target.checked;
    setMsg(caseSensitive ? "Agora exige maiúsculas/minúsculas." : "Agora ignora maiúsculas/minúsculas.", "");
    elInput.focus();
  });

  $("togglePunct").addEventListener("change", (e) => {
    keepPunct = !!e.target.checked;
    setMsg(keepPunct ? "Agora exige pontuação." : "Agora ignora pontuação.", "");
    elInput.focus();
  });

  // preload textarea
  $("words").value = DEFAULT_LIST.join("\n");
  reset();
</script>
</body>
</html>
